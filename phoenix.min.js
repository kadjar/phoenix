!function(){this.Phoenix={},this.Phoenix.Channel=function(){function a(a,b,c,d,e){this.channel=a,this.topic=b,this.message=c,this.callback=d,this.socket=e,this.reset()}return a.prototype.bindings=null,a.prototype.reset=function(){return this.bindings=[]},a.prototype.on=function(a,b){return this.bindings.push({event:a,callback:b})},a.prototype.isMember=function(a,b){return this.channel===a&&this.topic===b},a.prototype.off=function(a){var b;return this.bindings=function(){var c,d,e,f;for(e=this.bindings,f=[],c=0,d=e.length;d>c;c++)b=e[c],b.event!==a&&f.push(b);return f}.call(this)},a.prototype.trigger=function(a,b){var c,d,e,f,g,h,i;for(g=this.bindings,i=[],e=0,f=g.length;f>e;e++)h=g[e],d=h.event,c=h.callback,d===a&&i.push(c(b));return i},a.prototype.send=function(a,b){return this.socket.send({channel:this.channel,topic:this.topic,event:a,message:b})},a.prototype.leave=function(a){return null==a&&(a={}),this.socket.leave(this.channel,this.topic,a),this.reset()},a}(),this.Phoenix.Socket=function(){function a(a){this.endPoint=a,this.channels=[],this.sendBuffer=[],this.resetBufferTimer(),this.reconnect()}return a.prototype.conn=null,a.prototype.endPoint=null,a.prototype.channels=null,a.prototype.sendBuffer=null,a.prototype.sendBufferTimer=null,a.prototype.flushEveryMs=50,a.prototype.reconnectTimer=null,a.prototype.reconnectAfterMs=5e3,a.prototype.close=function(a){return null!=this.conn&&(this.conn.onclose=function(){return function(){}}(this),this.conn.close(),this.conn=null),"function"==typeof a?a():void 0},a.prototype.reconnect=function(){return this.close(function(a){return function(){return a.conn=new WebSocket(a.endPoint),a.conn.onopen=function(){return a.onOpen()},a.conn.onerror=function(b){return a.onError(b)},a.conn.onmessage=function(b){return a.onMessage(b)},a.conn.onclose=function(b){return a.onClose(b)}}}(this))},a.prototype.resetBufferTimer=function(){return clearTimeout(this.sendBufferTimer),this.sendBufferTimer=setTimeout(function(a){return function(){return a.flushSendBuffer()}}(this),this.flushEveryMs)},a.prototype.onOpen=function(){return clearInterval(this.reconnectTimer),this.rejoinAll()},a.prototype.onClose=function(a){return"function"==typeof console.log&&console.log("WS close: "+a),clearInterval(this.reconnectTimer),this.reconnectTimer=setInterval(function(a){return function(){return a.reconnect()}}(this),this.reconnectAfterMs)},a.prototype.onError=function(a){return"function"==typeof console.log?console.log("WS error: "+a):void 0},a.prototype.connectionState=function(){var a,b;switch(null!=(a=null!=(b=this.conn)?b.readyState:void 0)?a:3){case 0:return"connecting";case 1:return"open";case 2:return"closing";case 3:return"closed"}},a.prototype.isConnected=function(){return"open"===this.connectionState()},a.prototype.rejoinAll=function(){var a,b,c,d,e;for(d=this.channels,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.rejoin(a));return e},a.prototype.rejoin=function(a){var b,c,d;return a.reset(),b=a.channel,d=a.topic,c=a.message,this.send({channel:b,topic:d,event:"join",message:c}),a.callback(a)},a.prototype.join=function(a,b,c,d){var e;return e=new Phoenix.Channel(a,b,c,d,this),this.channels.push(e),this.isConnected()?this.rejoin(e):void 0},a.prototype.leave=function(a,b,c){var d;return null==c&&(c={}),this.send({channel:a,topic:b,event:"leave",message:c}),this.channels=function(){var c,e,f,g;for(f=this.channels,g=[],c=0,e=f.length;e>c;c++)d=f[c],d.isMember(a,b)||g.push(d);return g}.call(this)},a.prototype.send=function(a){var b;return b=function(b){return function(){return b.conn.send(JSON.stringify(a))}}(this),this.isConnected()?b():this.sendBuffer.push(b)},a.prototype.flushSendBuffer=function(){var a,b,c,d;if(this.isConnected()&&this.sendBuffer.length>0){for(d=this.sendBuffer,b=0,c=d.length;c>b;b++)a=d[b],a();this.sendBuffer=[]}return this.resetBufferTimer()},a.prototype.onMessage=function(a){var b,c,d,e,f,g,h,i,j,k;for("function"==typeof console.log&&console.log(a),i=JSON.parse(a.data),c=i.channel,f=i.topic,d=i.event,e=i.message,j=this.channels,k=[],g=0,h=j.length;h>g;g++)b=j[g],b.isMember(c,f)&&k.push(b.trigger(d,e));return k},a}()}.call(this);